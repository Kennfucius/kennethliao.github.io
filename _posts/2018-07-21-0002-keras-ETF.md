---
title: "Stock Market Series: Part 1 - Forecasting With a Simple Neural Network"
date: 2018-07-21
tags: [Stock Market, Neural Network, Forecasting, Prediction]
header:
  overlay_image: "/images/0002-keras-ETF/0002-banner1-small.jpg"
  overlay_filter: 0.5
  teaser: "/images/0002-keras-ETF/0002-banner3.jpg"
excerpt: "Stock market forecasting with simple neural network"
mathjax: "true"
# This sets the table of contents on the right of the page
toc: true
toc_label: "Table of Contents"
toc_icon: "chart-line"
toc_sticky: "true"
---

# Objective
I created a simple neural network (NN) using the [Keras](https://keras.io/) API. The NN was trained to predict future exchange traded fund (ETF) prices based on common economic indicators. In part 1 of this series, I explore whether forecasting the stock market using economic indicators is a viable strategy. Subsequent studies will include tuning hyperparameters, trying different NN architectures, and a comparison to other methods such as time series forecasting.

# Background

> Note: All visualizations are interactive and were generated using [plotly](https://plot.ly/python/). Data can be filtered by selecting or unselecting items in the legend.

### Data

#### Figure 1 | Sector ETF Time Series
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<iframe width="100%" height="550" frameborder="0" scrolling="no" src="/images/0002-keras-ETF/sectorETFs.html"></iframe>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Data for six U.S. sector ETFs was obtained from yahoo finance. The data spans May 2000 to September 2017 and the period is 1 week. Sector ETFs can experience significantly less volatility than their underlying assets. This makes them attractive for forecasting. Figure 1 shows the time series plots for all six sector ETFs.

1. Technology ([IYW](https://finance.yahoo.com/quote/IYW))
2. Basic Materials ([IYM](https://finance.yahoo.com/quote/IYM))
3. Consumer Goods ([IYK](https://finance.yahoo.com/quote/IYK))
4. Services ([IYC](https://finance.yahoo.com/quote/IYC))
5. Healthcare ([IYH](https://finance.yahoo.com/quote/IYH))
6. Utilities ([IDU](https://finance.yahoo.com/quote/IDU))

#### Figure 2 | Indicators
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<iframe width="100%" height="550" frameborder="0" scrolling="no" src="/images/0002-keras-ETF/indicators.html"></iframe>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The raw values for the 10 economic indicators used to train the model are shown in Figure 2; to resolve all indicators, data can be filtered by selecting or unselecting items in the figure legend. See the expandable list below for descriptions of each indicator.

<details>
  <summary>Economic indicator descriptions. </summary>
    <table style="width:100%"><tr><th>Indicator</th><th>Description</th></tr>
    <tr><td>HOUST</td><td>Housing Starts: Total: New Privately Owned Housing Units Started</td></tr>
    <tr><td>UNRATENSA</td><td>Civilian Unemployment Rate NSA</td></tr>
    <tr><td>EMRATIO</td><td>Civilian Employment-Population Ratio</td></tr>
    <tr><td>UEMPMED</td><td>Median Duration of Unemployment</td></tr>
    <tr><td>UMCSENT</td><td>University of Michigan: Consumer Sentiment</td></tr>
    <tr><td>USSLIND</td><td>Leading Index for the United States</td></tr>
    <tr><td>KCFSI</td><td>Kansas City Financial Stress Index</td></tr>
    <tr><td>IPMAN</td><td>Industrial Production: Manufacturing (NAICS)</td></tr>
    <tr><td>VIXCLS</td><td>CBOE Volatility Index: NSA</td></tr>
    <tr><td>DGS10</td><td>10-Year Treasury Constant Maturity Rate</td></tr></table>
</details>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; I'll start by modeling 5 years of the weekly data going back from September 8, 2017. Longer timespans will be explored in future studies. This 5 year subset is divided into training and cross-validation (CV) datasets in an 80/20 split: 4 years of training data will be used to predict weekly prices for the 5th year.

### Model

#### Figure 3 | Diagram of NN Model
![NN Model]({{ "/images/0002-keras-ETF/nn-model.png" | absolute_url }})

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Figure 3 shows a simplified diagram of the NN model. The model is about as simple as you can get with just a single hidden layer. The input layer contains 10 neurons corresponding to the 10 economic indicators. The hidden layer contains 20 neurons and output layer 6. The NN is fully connected which means that every neuron in a given layer is connected to every neuron in the next layer. This is depicted with two neurons in each layer: the remaining connections are omitted for clarity. The model is thus designed to take in values of 10 indicators for a given week, and predict the values of the 6 sector ETFs for that week.

# Results

#### Figure 4 | Predicted vs Actual Values
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<iframe width="100%" height="550" frameborder="0" scrolling="no" src="/images/0002-keras-ETF/predictions-0.html"></iframe>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Figure 4 shows the output of the model for the Technology ETF. The blue line is the actual price data for the ETF while the orange line shows the model's prediction. Up until the green region, the orange line depicts how well the model is able to fit the training data. Recall that the model is generating the ETF prices based on economic indicator values.

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The cross-validation data is highlighted in green and begins on September 23rd, 2016. The model does not see economic indicator values in this region during training. Once trained, the model is then given these unseen indicator values and outputs what it thinks the ETF price should be. At first glance, the predicted price line seems to follow the general trend of the actual data. Around March 2017 the model does begin to overshoot and then seems to not follow the upward trend thereafter. However the results seem promising for a simple model without optimization! Expand the list below for the other 5 ETF predictions.

<details>
  <summary>Remaining 5 sector ETF predictions. </summary>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <iframe width="100%" height="550" frameborder="0" scrolling="no" src="/images/0002-keras-ETF/predictions-1.html"></iframe>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <iframe width="100%" height="550" frameborder="0" scrolling="no" src="/images/0002-keras-ETF/predictions-2.html"></iframe>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <iframe width="100%" height="550" frameborder="0" scrolling="no" src="/images/0002-keras-ETF/predictions-3.html"></iframe>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <iframe width="100%" height="550" frameborder="0" scrolling="no" src="/images/0002-keras-ETF/predictions-4.html"></iframe>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <iframe width="100%" height="550" frameborder="0" scrolling="no" src="/images/0002-keras-ETF/predictions-5.html"></iframe>
</details>

#### Figure 5 | Learning Curves
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<iframe width="100%" height="550" frameborder="0" scrolling="no" src="/images/0002-keras-ETF/sectorETF-learningcurves.html"></iframe>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; To visualize the accuracy of the model, a learning curve plots the root mean-squared error (RMSE) against training iteration or epoch. As the model learns to fit the training data, the training RMSE is reduced and the model is able to better predict ETF prices in the CV data set. However, there can be a point in which the training data can be over fit. Overfitting occurs when the training data is fit so well by an overly complex regression, that the model cannot generalize well to unseen data. In this case, both the training and CV error continue to decrease with training iteration. Increasing the number of training epochs can thus continue to improve the model's accuracy.

#### Figure 6 | Predicted vs Actual Values - TRAINING
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<iframe width="100%" height="550" frameborder="0" scrolling="no" src="/images/0002-keras-ETF/prediction-ratios-train.html"></iframe>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; To get a general sense of the dispersion in the model's predictions, the predicted values can be plotted against the actual values for all ETFs. Figure 6 shows this dispersion on the training data. The data is normalized when fed into the model and thus ranges between 0 and 1, however the predicted values can be outside of these limits. The orange line has a slope of one and shows where all the points would lie if the model was perfectly accurate. There are a couple of noteworthy points to make about this figure. First, notice that some of the predicted values go negative at the lower end and above one at the higher end. The model's accuracy may therefore be improved by simply putting fixed limits at 0 and 1 on the model's predictions. Second, more points seem to fall below the orange line at higher actual values, indicated the model tends to under predict at higher prices. Figure 7 shows the dispersion of the model's predictions on the CV data.

#### Figure 7 | Predicted vs Actual Values - CV
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<iframe width="100%" height="550" frameborder="0" scrolling="no" src="/images/0002-keras-ETF/prediction-ratios-cv.html"></iframe>

#### Figure 8 | Technology ETF vs Indicators
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<iframe width="100%" height="550" frameborder="0" scrolling="no" src="/images/0002-keras-ETF/tech-dep-HOUST.html"></iframe>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; This was a great exercise in setting up a simple NN model for stock market forecasting, but ultimately I want to know whether these economic indicators are good predictors of the sector ETF prices. This is an important question to answer before devoting resources and time into model optimization. Since the NN model is performing a regression on the ETF prices vs economic indicators, the model's accuracy should depend on how well prices are correlated with the indicators. Figure 8 shows the Technology ETF price vs the housing starts indicator (HOUST). It's important to point out that the relationship need not be linear, but there should be good correlation. 

<details>
  <summary>Remaining 9 indicator dependence plots. </summary>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<iframe width="100%" height="550" frameborder="0" scrolling="no" src="/images/0002-keras-ETF/tech-dep-EMRATIO.html"></iframe>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<iframe width="100%" height="550" frameborder="0" scrolling="no" src="/images/0002-keras-ETF/tech-dep-DGS10.html"></iframe>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<iframe width="100%" height="550" frameborder="0" scrolling="no" src="/images/0002-keras-ETF/tech-dep-IPMAN.html"></iframe>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<iframe width="100%" height="550" frameborder="0" scrolling="no" src="/images/0002-keras-ETF/tech-dep-KCFSI.html"></iframe>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<iframe width="100%" height="550" frameborder="0" scrolling="no" src="/images/0002-keras-ETF/tech-dep-UEMPMED.html"></iframe>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<iframe width="100%" height="550" frameborder="0" scrolling="no" src="/images/0002-keras-ETF/tech-dep-UMCSENT.html"></iframe>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<iframe width="100%" height="550" frameborder="0" scrolling="no" src="/images/0002-keras-ETF/tech-dep-UNRATENSA.html"></iframe>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<iframe width="100%" height="550" frameborder="0" scrolling="no" src="/images/0002-keras-ETF/tech-dep-USSLIND.html"></iframe>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<iframe width="100%" height="550" frameborder="0" scrolling="no" src="/images/0002-keras-ETF/tech-dep-VIXCLS.html"></iframe>

# Summary

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;

# Resources
